# /config/yaml_mappings/product_magento_woo.yaml
source: magento
target: woocommerce
entity: category
description: Mapping definition from Magento Category structure to WooCommerce Category structure.

fields:
  # Trường nguồn (Magento) : Trường đích (WooCommerce)
  parent_id: parent
  name: name
  position: menu_order

# python đọc tên hàm và gọi hàm ở common_transformers.py
transformations:
  name:
    - type: function
      function_name: normalize_string_mapper
  parent_id:
    - type: function
      function_name: map_id_to_target
      params:
        entity: category
        source_id_field: id

# python đọc tên hàm và gọi hàm ở common_validators.py
validators:
  # Quy tắc cho trường 'name' (Tên danh mục)
  name:
    - type: function
      function_name: not_null               # Yêu cầu tên không được rỗng
      on_fail: skip_record                  # Nếu không hợp lệ, bỏ qua bản ghi này
    - type: function
      function_name: is_string_min_length   # Yêu cầu tên có độ dài tối thiểu
      params:
        min_length: 3                       # Độ dài tối thiểu là 3 ký tự
      on_fail: log_warning

  # Quy tắc cho trường 'parent_id' (ID danh mục cha)
  parent_id:
    - type: function
      function_name: is_integer             # Đảm bảo parent_id là một số nguyên
      on_fail: set_to_default
      default_value: 0                      # Nếu không phải số, đặt mặc định là 0 (danh mục gốc)

  # Quy tắc cho trường 'position' (Thứ tự hiển thị / Menu Order)
  position:
    - type: function
      function_name: is_non_negative_integer # Yêu cầu là số nguyên không âm (>= 0)
      on_fail: set_to_default
      default_value: 0                      # Nếu không hợp lệ, đặt mặc định là 0
    - type: function
      function_name: is_max_value           # Giới hạn giá trị tối đa
      params:
        max_value: 1000                     # Ví dụ: không lớn hơn 1000
      on_fail: truncate_value

# Sau khi gọi API, thêm id vào ánh xạ, ví dụ:
#  {
#    1: 2,
#    2:4
#  }
post_processors:
  - type: function
    function_name: save_id_mapping
    params:
      source_id_field: id
      target_id_field: id
      entity: category